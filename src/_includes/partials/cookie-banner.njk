<!-- Cookie Consent Banner -->
<div id="cookieConsent" class="cookie-consent">
  <div class="cookie-content">
    <p>
      üç™ Wir verwenden Cookies und √§hnliche Technologien (Google Analytics, Facebook Pixel), 
      um die Nutzung unserer Website zu analysieren und zu verbessern. 
      <a href="/datenschutz/" class="cookie-link">Mehr Infos</a>
    </p>
    <div class="cookie-buttons">
      <button class="cookie-btn cookie-btn-accept" onclick="acceptCookies()">
        Alle akzeptieren
      </button>
      <button class="cookie-btn cookie-btn-decline" onclick="declineCookies()">
        Nur notwendige
      </button>
    </div>
  </div>
</div>

<script>
(function() {
  const consent = localStorage.getItem('cookie-consent');
  
  if (!consent) {
    setTimeout(() => {
      document.getElementById('cookieConsent').classList.add('show');
    }, 1000);
  } else if (consent === 'accepted') {
    loadTrackingScripts();
  }
})();

function acceptCookies() {
  localStorage.setItem('cookie-consent', 'accepted');
  document.getElementById('cookieConsent').classList.remove('show');
  loadTrackingScripts();
}

function declineCookies() {
  localStorage.setItem('cookie-consent', 'declined');
  document.getElementById('cookieConsent').classList.remove('show');
}

function loadTrackingScripts() {
  // Load tracking scripts from analytics data
  const gaId = "{{ analytics.googleAnalyticsId | default('') }}";
  const fbId = "{{ analytics.facebookPixelId | default('') }}";

  // Load Google Analytics if ID is present
  if (gaId) {
    const gaScript = document.createElement('script');
    gaScript.src = `https://www.googletagmanager.com/gtag/js?id=${gaId}`;
    gaScript.async = true;
    document.head.appendChild(gaScript);
    
    gaScript.onload = function() {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', gaId);
    };
  }

  // Load Facebook Pixel if ID is present
  if (fbId) {
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', fbId);
    fbq('track', 'PageView');
  }
}
</script>
